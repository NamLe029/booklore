<div class="settings-card">
  <div class="section-header">
    <div class="section-header-row">
      <div class="section-header-text">
        <h3 class="section-title">
          <i class="pi pi-users"></i>
          Recipient Emails
        </h3>
        <p class="section-description">
          Manage recipient email addresses for sending books. The default recipient is used for 'Quick Book Send' in the Book Card menu.
        </p>
      </div>
      <p-button
        icon="pi pi-plus"
        label="Add Recipient"
        severity="success"
        size="small"
        [outlined]="true"
        (onClick)="openAddRecipientDialog()">
      </p-button>
    </div>
  </div>

  <div class="section-body">
    @if (recipientEmails.length === 0) {
      <div class="empty-state">
        <i class="pi pi-users"></i>
        <p class="empty-title">No recipients configured</p>
        <p class="empty-subtitle">Add your first email recipient to start sending books</p>
      </div>
    } @else {
      <div class="recipients-list">
        @for (recipient of recipientEmails; track recipient.id) {
          <div class="recipient-item" [class.is-default]="recipient.id === defaultRecipientId">
            <div class="recipient-content">
              <div class="recipient-select">
                <p-radioButton
                  name="defaultRecipient"
                  [value]="recipient.id"
                  [(ngModel)]="defaultRecipientId"
                  (onClick)="setDefaultRecipient(recipient)">
                </p-radioButton>
              </div>

              <div class="recipient-info">
                @if (recipient.isEditing) {
                  <div class="edit-form">
                    <div class="form-field">
                      <label class="field-label">
                        <i class="pi pi-envelope"></i>
                        Email
                      </label>
                      <input type="email" pInputText [(ngModel)]="recipient.email" placeholder="recipient@example.com"/>
                    </div>
                    <div class="form-field">
                      <label class="field-label">
                        <i class="pi pi-user"></i>
                        Name
                      </label>
                      <input type="text" pInputText [(ngModel)]="recipient.name" placeholder="Recipient name"/>
                    </div>
                  </div>
                } @else {
                  <div class="recipient-details">
                    <div class="recipient-email">
                      <i class="pi pi-envelope"></i>
                      <span>{{ recipient.email }}</span>
                      @if (recipient.id === defaultRecipientId) {
                        <span class="default-badge">Default</span>
                      }
                    </div>
                    @if (recipient.name) {
                      <div class="recipient-name">
                        <i class="pi pi-user"></i>
                        <span>{{ recipient.name }}</span>
                      </div>
                    }
                  </div>
                }
              </div>

              <div class="recipient-actions">
                @if (!recipient.isEditing) {
                  <p-button
                    icon="pi pi-pencil"
                    severity="info"
                    size="small"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="toggleEditRecipient(recipient)"
                    pTooltip="Edit recipient">
                  </p-button>
                  <p-button
                    icon="pi pi-trash"
                    severity="danger"
                    size="small"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="deleteRecipient(recipient)"
                    pTooltip="Delete recipient">
                  </p-button>
                } @else {
                  <p-button
                    icon="pi pi-check"
                    severity="success"
                    size="small"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="saveRecipient(recipient)"
                    pTooltip="Save changes">
                  </p-button>
                  <p-button
                    icon="pi pi-times"
                    severity="secondary"
                    size="small"
                    [outlined]="true"
                    [rounded]="true"
                    (onClick)="toggleEditRecipient(recipient)"
                    pTooltip="Cancel">
                  </p-button>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
