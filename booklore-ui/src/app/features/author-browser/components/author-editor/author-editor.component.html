<ng-container *transloco="let t; prefix: 'authorBrowser.editor'">
  <div class="editor-container">
    <div class="cover-section">
      @if (hasPhoto) {
        <p-image
          [src]="photoUrl"
          alt="Author Photo"
          width="200"
          appendTo="body"
          [preview]="true"
          (onImageError)="onPhotoError()">
        </p-image>
      } @else {
        <div class="photo-placeholder">
          <i class="pi pi-user"></i>
        </div>
      }

      @if (isUploading) {
        <p-progressSpinner class="upload-spinner" strokeWidth="4" fill="transparent" animationDuration=".8s"></p-progressSpinner>
      }

      <div class="cover-actions">
        <p-fileupload
          [chooseStyleClass]="'p-button-sm p-button-outlined p-button-danger'"
          [pTooltip]="t('uploadPhotoTooltip')"
          tooltipPosition="top"
          [disabled]="form.get('photoLocked')?.value"
          name="file"
          [url]="uploadUrl"
          mode="basic"
          chooseIcon="pi pi-upload"
          accept="image/jpeg,image/png"
          maxFileSize="5000000"
          (onUpload)="onUpload()"
          (onError)="onUploadError()"
          [auto]="true"
          (onBeforeUpload)="onBeforeUpload()">
        </p-fileupload>

        <p-button
          [pTooltip]="t('searchPhotoTooltip')"
          tooltipPosition="top"
          size="small"
          icon="pi pi-search"
          [outlined]="true"
          [disabled]="form.get('photoLocked')?.value"
          (onClick)="openPhotoSearch()"
          severity="info">
        </p-button>

        @if (!form.get('photoLocked')?.value) {
          <p-button
            [pTooltip]="t('lockField')"
            tooltipPosition="top"
            size="small"
            icon="pi pi-lock-open"
            [outlined]="true"
            (onClick)="togglePhotoLock()"
            severity="success">
          </p-button>
        }
        @if (form.get('photoLocked')?.value) {
          <p-button
            [pTooltip]="t('unlockField')"
            tooltipPosition="top"
            size="small"
            icon="pi pi-lock"
            [outlined]="true"
            (onClick)="togglePhotoLock()"
            severity="warn">
          </p-button>
        }
      </div>
    </div>

    <form class="fields-section" [formGroup]="form" (ngSubmit)="onSave()">
      <div class="field-group">
        <label for="authorName">{{ t('nameLabel') }}</label>
        <div class="field-with-lock">
          <input pInputText id="authorName" formControlName="name"/>
          @if (!form.get('nameLocked')?.value) {
            <p-button icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock('name')" severity="success"></p-button>
          }
          @if (form.get('nameLocked')?.value) {
            <p-button icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock('name')" severity="warn"></p-button>
          }
        </div>
      </div>

      <div class="field-group">
        <label for="authorAsin">{{ t('asinLabel') }}</label>
        <div class="field-with-lock">
          <input pInputText id="authorAsin" formControlName="asin"/>
          @if (!form.get('asinLocked')?.value) {
            <p-button icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock('asin')" severity="success"></p-button>
          }
          @if (form.get('asinLocked')?.value) {
            <p-button icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock('asin')" severity="warn"></p-button>
          }
        </div>
      </div>

      <div class="field-group description-group">
        <label for="authorDescription">{{ t('descriptionLabel') }}</label>
        <div class="field-with-lock description-with-lock">
          <textarea pTextarea id="authorDescription" formControlName="description"
            [rows]="8" [autoResize]="true"></textarea>
          @if (!form.get('descriptionLocked')?.value) {
            <p-button icon="pi pi-lock-open" [outlined]="true" (onClick)="toggleLock('description')" severity="success" size="small"></p-button>
          }
          @if (form.get('descriptionLocked')?.value) {
            <p-button icon="pi pi-lock" [outlined]="true" (onClick)="toggleLock('description')" severity="warn" size="small"></p-button>
          }
        </div>
      </div>

      <div class="form-footer">
        <p-divider></p-divider>
        <div class="footer-actions">
          <p-button [label]="t('unlockAllBtn')" icon="pi pi-lock-open" [outlined]="true" severity="success" (onClick)="unlockAll()"></p-button>
          <p-button [label]="t('lockAllBtn')" icon="pi pi-lock" [outlined]="true" severity="warn" (onClick)="lockAll()"></p-button>
          <p-divider layout="vertical"/>
          <p-button
            type="submit"
            [label]="isSaving ? t('saving') : t('saveBtn')"
            [icon]="isSaving ? 'pi pi-spin pi-spinner' : 'pi pi-check'"
            [disabled]="isSaving">
          </p-button>
        </div>
      </div>
    </form>
  </div>
</ng-container>
